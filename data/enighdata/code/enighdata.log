
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 19.5
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2025 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: 65-student 2-core lab, expiring 18 May 2026
Serial number: 501909312971
  Licensed to: Victor Ortega
               Columbia University

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.

. do "enighdata.do" 

. *************************************************
. ***************** Clean Memory ******************
. *************************************************
. 
. clear

. cap clear

. cap log close

. set more off

. 
. *** REPLICATION FILE: enighdata
. *** STATA VERSION: 18/SE
. *** AUTHOR: Victor Alfonso Ortega Le Hénanff
. *** EMAIL: vincictor33@gmail.com
. *** DATE: 2025-02-16
. 
. *************************************************
. **************** Define Globals *****************
. *************************************************
. 
. global project="/Users/victorortega/Dropbox/mw_ethnic/downloaddata/output"

. global output="/Users/victorortega/Dropbox/mw_ethnic/enighdata/output"

. 
. *************************************************
. ************** INFLATION DATASET ***************
. *************************************************
. 
. tempfile deflators

. import delimited using "../input/inpc.csv", clear varnames(1)
(encoding automatically selected: UTF-8)
(1 var, 84 obs)

. gen year = 2016 + int((_n-1)/12)

. gen month = mod(_n-1, 12) + 1

. gen mes = string(month)

. replace mes = "0" + mes if month < 10
(63 real changes made)

. gen time = date(string(year) + "-" + mes, "YM")

. format time %td

. drop year month mes

. save `deflators'
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St12720.000001 saved
    as .dta format

. 
. *************************************************
. ******* LOOP FOR ALL ENIGH DATASETS ************
. *************************************************
. 
. local years "2016 2018 2020 2022"

. local cumulative_ids = 0

. local tempfiles ""

. 
. foreach year of local years {
  2.     display "Processing ENIGH `year' dataset..."
  3.     
.     *************************************************
.     ******** Poblacion and concentradohogar *********
.     *************************************************
.     
.     use "../input/poblacion`year'.dta", clear
  4.     egen new_id = concat(folioviv foliohog numren)
  5.     keep new_id hablaind lenguaind comprenind etnia sexo edad madre_hog pa
> dre_hog asis_esc nivelaprob gradoaprob residencia hor_1 trabajo_mp 
  6.     tempfile pop_data_`year'
  7.     save `pop_data_`year''
  8.     
.     use "../input/concentradohogar`year'.dta", clear
  9.     collapse (first) ubica_geo, by(folioviv)
 10.     tempfile hog_data_`year'
 11.     save `hog_data_`year''
 12.     
.     *************************************************
.     ************ Ingresos ENIGH dataset *************
.     *************************************************
.     
.     use "../input/ingresos`year'.dta", clear
 13.     egen new_id = concat(folioviv foliohog numren)
 14.     
.     gen clave_group = ""
 15.     
.     /*Income Classification - consistent across all years*/
.     replace clave_group = "wages" if inlist(clave, "P001", "P002", "P011", "P
> 018", "P019", "P067")
 16.     
.     replace clave_group = "non_wage_income" if inlist(clave, "P003", "P004", 
> "P005", "P006", "P007", "P009")
 17.     replace clave_group = "non_wage_income" if inlist(clave, "P008","P014"
> ,"P015","P016")
 18.     
.     replace clave_group = "gov_transfers" if inlist(clave, "P032","P033","P03
> 8","P040","P042","P043","P044","P045") 
 19.     replace clave_group = "gov_transfers" if inlist(clave, "P048","P101","
> P046","P047","P102","P103")
 20.     replace clave_group = "gov_transfers" if inlist(clave, "P104","P105","
> P106","P107","P108")
 21.     
.     replace clave_group = "other" if inlist(clave, "P012","P013","P020","P021
> ","P022","P034","P035","P036","P037")
 22.     replace clave_group = "other" if inlist(clave, "P041","P049","P051","P
> 057","P058","P039")
 23.         
.     replace clave_group = "rentas" if inlist(clave, "P023","P024","P025")
 24.     
.     replace clave_group = "fin_capital" if inlist(clave, "P026","P027","P028"
> ,"P029","P030","P031","P050")
 25.     replace clave_group = "fin_capital" if inlist(clave, "P065","P066","P0
> 52","P053","P064")
 26.     
.     replace clave_group = "negocio" if inlist(clave, "P068","P069","P070","P0
> 71","P072","P073","P074")  
 27.     replace clave_group = "negocio" if inlist(clave, "P078","P079","P080",
> "P081","P075","P076","P077")
 28.     
.     replace clave_group = "ventas" if inlist(clave, "P054","P055","P056","P05
> 9","P060","P061","P062","P063")
 29.     
.     *Collapse income by income classes
.     collapse (sum) ing_1 ing_2 ing_3 ing_4 ing_5 ing_6 (first) mes_1 mes_2 me
> s_3 mes_4 mes_5 mes_6, by(new_id clave_group)
 30.     
.     * Replace spaces with the value from the other row with the same new_id
.     foreach mes in mes_1 mes_2 mes_3 mes_4 mes_5 mes_6 {
 31.         replace `mes' = `mes'[_n-1] if `mes' == " " & new_id == new_id[_n-
> 1]
 32.         replace `mes' = `mes'[_n+1] if `mes' == " " & new_id == new_id[_n+
> 1]
 33.     }
 34.     
.     *Create a panel dataset
.     reshape long ing_, i(new_id clave_group) j(month)
 35.     gen mes = ""
 36.     
.     * Loop through the months and assign the value from mes_1, mes_2, mes_3..
> .
.     foreach m of numlist 1/6 {
 37.         replace mes = mes_`m' if month == `m'
 38.     }
 39.     
.     drop month mes_1 mes_2 mes_3 mes_4 mes_5
 40.     
.     gen ing_wages = ing_ if clave_group == "wages"
 41.     gen ing_non_wage_income = ing_ if clave_group == "non_wage_income"
 42.     gen ing_fin_capital = ing_ if clave_group == "fin_capital"
 43.     gen ing_gov_transfers = ing_ if clave_group == "gov_transfers"
 44.     gen ing_negocio = ing_ if clave_group == "negocio"
 45.     gen ing_other = ing_ if clave_group == "other"
 46.     gen ing_rentas = ing_ if clave_group == "rentas"
 47.     gen ing_ventas = ing_ if clave_group == "ventas"
 48.     
.     collapse (max) ing_wages ing_non_wage_income ing_fin_capital ing_gov_tran
> sfers ing_negocio ing_other ing_rentas ing_ventas, by(new_id mes mes_6)
 49.     
.     drop mes_6
 50.     
.     *************************************************
.     ************ Merge with previous datasets *******
.     *************************************************
.     
.     merge m:1 new_id using `pop_data_`year''
 51.     drop _merge
 52.     gen folioviv = substr(new_id, 1, length(new_id) - 3)
 53.     
.     merge m:1 folioviv using `hog_data_`year'', keepusing(ubica_geo)
 54.     drop _merge
 55.     
.     *************************************************
.     ************ Data cleanup for estimation ********
.     *************************************************
.     
.     sort new_id mes
 56.     
.     *generate date
.     gen time = date("`year'-" + mes, "YM")
 57.     format time %td
 58.     order time, after(mes)
 59.     gen year = `year'
 60.     order year, after(time)
 61.     label variable time "month year date"
 62.     drop mes
 63.     
.     *generate gender
.     gen gender = .
 64.     replace gender = 1 if sexo == "1"
 65.     replace gender = 0 if sexo == "2"
 66.     label define genderlbl 1 "Male" 0 "Female"
 67.     label values gender genderlbl
 68.     order gender, after(sexo)
 69.     label variable gender "gender"
 70.     label variable edad "age"
 71.     order gender edad, after(time)
 72.     drop sexo
 73.     
.     *mother and father home
.     gen motherhome = .
 74.     replace motherhome = 1 if madre_hog == "1"
 75.     replace motherhome = 0 if madre_hog == "2"
 76.     label define motherlbl 1 "Yes" 0 "No"
 77.     label values motherhome motherlbl
 78.     order motherhome, after(madre_hog)
 79.     label variable motherhome "lives with mother"
 80.     drop madre_hog
 81.     
.     gen fatherhome = .
 82.     replace fatherhome = 1 if padre_hog == "1"
 83.     replace fatherhome = 0 if padre_hog == "2"
 84.     label define fatherlbl 1 "Yes" 0 "No"
 85.     label values fatherhome fatherlbl
 86.     order fatherhome, before(motherhome)
 87.     label variable fatherhome "lives with father"
 88.     drop padre_hog
 89.     
.     *indigenous language speaker
.     gen indspeaker = .
 90.     replace indspeaker = 1 if hablaind == "1"
 91.     replace indspeaker = 0 if hablaind == "2"
 92.     label define indspeakerlbl 1 "Yes" 0 "No"
 93.     label values indspeaker indspeakerlbl
 94.     order indspeaker, before(hablaind)
 95.     label variable indspeaker "speaks indigenous language"
 96.     drop hablaind
 97.     
.     *indigenous language 
.     rename lenguaind indlang
 98.     label variable indlang "indigenous language spoken"
 99.     destring indlang, replace
100.     
.     * Define indigenous language labels (complete list)
.     label define indlanglbl ///
>         111 "Paipai" ///
>         112 "Kiliwa" ///
>         113 "Cucapá" ///
>         114 "Cochimí" ///
>         115 "Kumiai" ///
>         121 "Seri" ///
>         131 "Chontal de Oaxaca" ///
>         200 "Chinanteco" ///
>         211 "Chinanteco de Ojitlán" ///
>         212 "Chinanteco de Usila" ///
>         221 "Chinanteco de Quiotepec" ///
>         222 "Chinanteco de Yolox" ///
>         223 "Chinanteco de Sochiapan" ///
>         231 "Chinanteco de Palantla" ///
>         232 "Chinanteco de Valle Nacional" ///
>         241 "Chinanteco de Lalana" ///
>         243 "Unknown" ///
>         311 "Pame" ///
>         321 "Chichimeca Jonaz" ///
>         331 "Otomí" ///
>         332 "Mazahua" ///
>         341 "Matlatzinca" ///
>         342 "Ocuilteco" ///
>         400 "Zapoteco" ///
>         411 "Zapoteco de Ixtlán" ///
>         412 "Zapoteco Vijano" ///
>         413 "Zapoteco del Rincón" ///
>         421 "Zapoteco Vallista" ///
>         422 "Zapoteco del Istmo" ///
>         431 "Zapoteco de Cuixtla" ///
>         432 "Solteco" ///
>         433 "Zapoteco Sureño" ///
>         441 "Chatino" ///
>         450 "Mixteco" ///
>         451 "Mixteco Zona Costa" ///
>         452 "Mixteco Zona Alta" ///
>         453 "Mixteco Zona Baja" ///
>         454 "Mixteco Zona Mazateca" ///
>         455 "Mixteco de Puebla" ///
>         456 "Tacuate" ///
>         461 "Cuicateco" ///
>         471 "Triqui" ///
>         481 "Amuzgo" ///
>         482 "Amuzgo de Guerrero" ///
>         483 "Amuzgo de Oaxaca" ///
>         491 "Mazateco" ///
>         492 "Chocholteco" ///
>         493 "Ixcateco" ///
>         494 "Popoloca" ///
>         511 "Huave" ///
>         611 "Tlapaneco" ///
>         711 "Totonaca" ///
>         712 "Tepehua" ///
>         800 "Popoluca" ///
>         811 "Mixe" ///
>         812 "Popoluca de Oluta" ///
>         821 "Popoluca de la Sierra" ///
>         822 "Popoluca de Texistepec" ///
>         823 "Zoque" ///
>         824 "Ayapaneco" ///
>         911 "Huasteco" ///
>         921 "Lacandón" ///
>         922 "Maya" ///
>         931 "Ch'ol" ///
>         932 "Chontal de Tabasco" ///
>         933 "Tzeltal" ///
>         934 "Tzotzil" ///
>         935 "Tojolabal" ///
>         936 "Chuj" ///
>         941 "Mame" ///
>         942 "Ixil" ///
>         943 "Aguacateco" ///
>         951 "Motocintleco" ///
>         961 "Kanjobal" ///
>         962 "Jacalteco" ///
>         971 "Quiché" ///
>         972 "Cakchiquel" ///
>         981 "Kekchi" ///
>         1011 "Pima" ///
>         1012 "Pápago" ///
>         1013 "Tepehuano" ///
>         1014 "Tepehuano del Norte" ///
>         1015 "Tepehuano del Sur" ///
>         1021 "Tarahumara" ///
>         1022 "Mayo" ///
>         1023 "Yaqui" ///
>         1024 "Guarijío" ///
>         1031 "Cora" ///
>         1032 "Huichol" ///
>         1041 "Náhuatl" ///
>         1111 "Purépecha" ///
>         1211 "Kikapú" ///
>         1311 "Chontal" ///
>         1999 "Non Specified" ///
>         9999 "Non Specified" ///
>         5023 "Chapaneco" ///
>         5024 "Chiapaneco" ///
>         5025 "Chicomucelteco" ///
>         5050 "Guachichil" ///
>         5053 "Guaycura" ///
>         5063 "Huzco" ///
>         5098 "Teco" ///
>         5103 "Tehueco" ///
>         5501 "Añu" ///
>         5504 "Akatako" ///
>         5513 "Aymara" ///
>         5540 "Guajiro" ///
>         5544 "Guaymi" ///
>         5551 "Quechua" ///
>         5556 "Mayu" ///
>         5571 "Pipil" ///
>         5603 "Other American Languages" ///
>         5595 "Wayuu"
101.     label values indlang indlanglbl
102.     
.     *understands indigenous language 
.     gen indund = .
103.     replace indund = 1 if comprenind == "1"
104.     replace indund = 0 if comprenind == "2"
105.     label define indundlbl 0 "No" 1 "Yes"
106.     label values indund indundlbl
107.     order indund, before(comprenind)
108.     label variable indund "understands indigenous language"
109.     drop comprenind
110.     
.     *indigenous self-identification 
.     gen indigenous = .
111.     replace indigenous = 1 if etnia == "1"
112.     replace indigenous = 0 if etnia == "2"
113.     label define indigenouslbl 0 "No" 1 "Yes"
114.     label values indigenous indigenouslbl
115.     order indigenous, before(etnia)
116.     label variable indigenous "indigenous self-identification"
117.     drop etnia
118.     
.     *school attendance
.     gen school_attendance = .
119.     replace school_attendance = 1 if asis_esc == "1"
120.     replace school_attendance = 0 if asis_esc == "2"
121.     label define school_attendlbl 0 "No" 1 "Yes"
122.     label values school_attendance school_attendlbl
123.     order school_attendance, before(asis_esc)
124.     label variable school_attendance "school attendance"
125.     drop asis_esc
126.     
.     *years of school achieved
.     gen years_of_study = .
127.     replace years_of_study = 0 if nivelaprob == "0"
128.     replace years_of_study = 0 if nivelaprob == "1"
129.     replace years_of_study = 1 if nivelaprob == "2" & gradoaprob == "1"
130.     replace years_of_study = 2 if nivelaprob == "2" & gradoaprob == "2"
131.     replace years_of_study = 3 if nivelaprob == "2" & gradoaprob == "3"
132.     replace years_of_study = 4 if nivelaprob == "2" & gradoaprob == "4"
133.     replace years_of_study = 5 if nivelaprob == "2" & gradoaprob == "5"
134.     replace years_of_study = 6 if nivelaprob == "2" & gradoaprob == "6"
135.     replace years_of_study = 7 if nivelaprob == "3" & gradoaprob == "1"
136.     replace years_of_study = 8 if nivelaprob == "3" & gradoaprob == "2"
137.     replace years_of_study = 9 if nivelaprob == "3" & gradoaprob == "3"
138.     replace years_of_study = 10 if nivelaprob == "4" & gradoaprob == "1"
139.     replace years_of_study = 11 if nivelaprob == "4" & gradoaprob == "2"
140.     replace years_of_study = 12 if nivelaprob == "4" & gradoaprob == "3"
141.     replace years_of_study = 13 if nivelaprob == "5" & gradoaprob == "1"
142.     replace years_of_study = 14 if nivelaprob == "5" & gradoaprob == "2"
143.     replace years_of_study = 15 if nivelaprob == "5" & gradoaprob == "3"
144.     replace years_of_study = 16 if nivelaprob == "5" & gradoaprob == "4"
145.     replace years_of_study = 17 if nivelaprob == "5" & gradoaprob == "5"
146.     replace years_of_study = 13 if nivelaprob == "6" & gradoaprob == "1"
147.     replace years_of_study = 14 if nivelaprob == "6" & gradoaprob == "2"
148.     replace years_of_study = 15 if nivelaprob == "6" & gradoaprob == "3"
149.     replace years_of_study = 16 if nivelaprob == "6" & gradoaprob == "4"
150.     replace years_of_study = 17 if nivelaprob == "6" & gradoaprob == "5"
151.     replace years_of_study = 13 if nivelaprob == "7" & gradoaprob == "1"
152.     replace years_of_study = 14 if nivelaprob == "7" & gradoaprob == "2"
153.     replace years_of_study = 15 if nivelaprob == "7" & gradoaprob == "3"
154.     replace years_of_study = 16 if nivelaprob == "7" & gradoaprob == "4"
155.     replace years_of_study = 17 if nivelaprob == "7" & gradoaprob == "5"
156.     replace years_of_study = 18 if nivelaprob == "8" & gradoaprob == "1"
157.     replace years_of_study = 19 if nivelaprob == "8" & gradoaprob == "2"
158.     replace years_of_study = 20 if nivelaprob == "8" & gradoaprob == "3"
159.     replace years_of_study = 21 if nivelaprob == "9" & gradoaprob == "1"
160.     replace years_of_study = 22 if nivelaprob == "9" & gradoaprob == "2"
161.     replace years_of_study = 23 if nivelaprob == "9" & gradoaprob == "3"
162.     replace years_of_study = 24 if nivelaprob == "9" & gradoaprob == "4"
163.     replace years_of_study = 25 if nivelaprob == "9" & gradoaprob == "5"
164.     label variable years_of_study "years of study"
165.     order years_of_study, after(school_attendance)
166.     drop nivelaprob gradoaprob
167.     
.     *generate state
.     drop residencia
168.     gen state = substr(ubica_geo, 1, 2)
169.     destring state, replace
170.     label define states ///
>         1 "Aguascalientes" ///
>         2 "Baja California" ///
>         3 "Baja California Sur" ///
>         4 "Campeche" ///
>         5 "Coahuila" ///
>         6 "Colima" ///
>         7 "Chiapas" ///
>         8 "Chihuahua" ///
>         9 "Ciudad de México" ///
>         10 "Durango" ///
>         11 "Guanajuato" ///
>         12 "Guerrero" ///
>         13 "Hidalgo" ///
>         14 "Jalisco" ///
>         15 "México" ///
>         16 "Michoacán" ///
>         17 "Morelos" ///
>         18 "Nayarit" ///
>         19 "Nuevo León" ///
>         20 "Oaxaca" ///
>         21 "Puebla" ///
>         22 "Querétaro" ///
>         23 "Quintana Roo" ///
>         24 "San Luis Potosí" ///
>         25 "Sinaloa" ///
>         26 "Sonora" ///
>         27 "Tabasco" ///
>         28 "Tamaulipas" ///
>         29 "Tlaxcala" ///
>         30 "Veracruz" ///
>         31 "Yucatán" ///
>         32 "Zacatecas"
171. 
.     label values state states
172.     label variable state "state"
173.     label variable ubica_geo "municipality"
174.     label variable new_id "id"
175.     order ubica_geo state, after(new_id)
176.     
.     *work hours and employment dummy
.     rename hor_1 hoursworked
177.     label variable hoursworked "hours worked per week"
178.     gen employed = .
179.     replace employed = 1 if trabajo_mp == "1"
180.     replace employed = 0 if trabajo_mp == "2"
181.     label define employedlbl 0 "No" 1 "Yes"
182.     label values employed employedlbl
183.     drop trabajo_mp
184.     label variable employed "employed previous month"
185.     drop folioviv
186.     
.     *income labels
.     label variable ing_wages "wage income"
187.     label variable ing_non_wage_income "non wage labor income"
188.     label variable ing_gov_transfers "government transfer income"
189.     label variable ing_other "unclassified income"
190.     label variable ing_rentas "rental income"
191.     label variable ing_fin_capital "financial capital income"
192.     label variable ing_negocio "business income"
193.     label variable ing_ventas "sales income"
194.     
.     *clean id - generate unique IDs across years
.     egen dirty_id = group(new_id)
195.     gen id = dirty_id + `cumulative_ids'
196.     order id, before(new_id)
197.     drop dirty_id
198.     
.     *clean ubica_geo
.     replace ubica_geo = substr(ubica_geo, 1, length(ubica_geo) - 4)
199.     
.     *count unique individuals for next iteration
.     quietly: egen temp_max = max(id)
200.     local year_max = temp_max[1]
201.     drop temp_max
202.     local cumulative_ids = `year_max'
203.     
.     *tempfile for append later
.     tempfile enighdata`year'
204.     save `enighdata`year''
205.     
.     local tempfiles "`tempfiles' `enighdata`year''"
206.     
.     display "Finished processing `year'. Total individuals so far: `cumulativ
> e_ids'"
207. }
Processing ENIGH 2016 dataset...
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St12720.000002 saved
    as .dta format
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St12720.000003 saved
    as .dta format
(334,337 missing values generated)
variable clave_group was str1 now str5
(87,634 real changes made)
variable clave_group was str5 now str15
(67,059 real changes made)
(17,987 real changes made)
(78,525 real changes made)
(3,297 real changes made)
(0 real changes made)
(23,196 real changes made)
(15,084 real changes made)
(2,757 real changes made)
(703 real changes made)
(6,970 real changes made)
(22,540 real changes made)
(4,699 real changes made)
(3,886 real changes made)
(4,109 real changes made)
(26,970 real changes made)
(4,109 real changes made)
(26,970 real changes made)
(4,109 real changes made)
(26,970 real changes made)
(4,109 real changes made)
(26,970 real changes made)
(4,109 real changes made)
(26,970 real changes made)
(4,109 real changes made)
(26,970 real changes made)
(j = 1 2 3 4 5 6)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations          279,789   ->   1,678,734   
Number of variables                  14   ->   10          
j variable (6 values)                     ->   month
xij variables:
                  ing_1 ing_2 ... ing_6   ->   ing_
-----------------------------------------------------------------------------
(1,678,734 missing values generated)
variable mes was str1 now str2
(279,789 real changes made)
(279,789 real changes made)
(279,789 real changes made)
(279,789 real changes made)
(279,789 real changes made)
(279,789 real changes made)
(1,155,822 missing values generated)
(1,387,560 missing values generated)
(1,634,202 missing values generated)
(1,250,706 missing values generated)
(1,532,040 missing values generated)
(1,472,538 missing values generated)
(1,662,372 missing values generated)
(1,655,898 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        82,686
        from master                         0  (_merge==1)
        from using                     82,686  (_merge==2)

    Matched                         1,050,277  (_merge==3)
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                         1,132,963  (_merge==3)
    -----------------------------------------
(82,777 missing values generated)
(1,132,963 missing values generated)
(590,558 real changes made)
(542,405 real changes made)
(1,132,963 missing values generated)
(417,347 real changes made)
(715,616 real changes made)
(1,132,963 missing values generated)
(304,505 real changes made)
(828,458 real changes made)
(1,132,963 missing values generated)
(84,663 real changes made)
(1,030,442 real changes made)
indlang: all characters numeric; replaced as int
(1048300 missing values generated)
(1,132,963 missing values generated)
(29,880 real changes made)
(1,000,562 real changes made)
(1,132,963 missing values generated)
(370,389 real changes made)
(744,715 real changes made)
(1,132,963 missing values generated)
(256,170 real changes made)
(858,935 real changes made)
(1,132,963 missing values generated)
(67,833 real changes made)
(30,054 real changes made)
(32,011 real changes made)
(43,476 real changes made)
(58,289 real changes made)
(35,706 real changes made)
(32,815 real changes made)
(156,031 real changes made)
(28,813 real changes made)
(40,018 real changes made)
(246,101 real changes made)
(28,972 real changes made)
(30,372 real changes made)
(110,880 real changes made)
(230 real changes made)
(290 real changes made)
(1,281 real changes made)
(4,247 real changes made)
(1,014 real changes made)
(2,384 real changes made)
(8,763 real changes made)
(20,689 real changes made)
(1,808 real changes made)
(0 real changes made)
(12,031 real changes made)
(12,381 real changes made)
(13,990 real changes made)
(39,943 real changes made)
(42,710 real changes made)
(878 real changes made)
(6,567 real changes made)
(1,851 real changes made)
(619 real changes made)
(603 real changes made)
(537 real changes made)
(230 real changes made)
(97 real changes made)
state: all characters numeric; replaced as byte
(1,132,963 missing values generated)
(696,983 real changes made)
(297,979 real changes made)
(1,132,963 real changes made)
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St12720.000004 saved
    as .dta format
Finished processing 2016. Total individuals so far: 257805
Processing ENIGH 2018 dataset...
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St12720.000005 saved
    as .dta format
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St12720.000006 saved
    as .dta format
(348,487 missing values generated)
variable clave_group was str1 now str5
(93,476 real changes made)
variable clave_group was str5 now str15
(69,223 real changes made)
(19,151 real changes made)
(80,989 real changes made)
(1,523 real changes made)
(0 real changes made)
(22,881 real changes made)
(16,921 real changes made)
(2,968 real changes made)
(704 real changes made)
(7,086 real changes made)
(24,275 real changes made)
(5,173 real changes made)
(4,117 real changes made)
(4,254 real changes made)
(28,963 real changes made)
(4,254 real changes made)
(28,963 real changes made)
(4,254 real changes made)
(28,963 real changes made)
(4,254 real changes made)
(28,963 real changes made)
(4,254 real changes made)
(28,963 real changes made)
(4,254 real changes made)
(28,963 real changes made)
(j = 1 2 3 4 5 6)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations          291,890   ->   1,751,340   
Number of variables                  14   ->   10          
j variable (6 values)                     ->   month
xij variables:
                  ing_1 ing_2 ... ing_6   ->   ing_
-----------------------------------------------------------------------------
(1,751,340 missing values generated)
variable mes was str1 now str2
(291,890 real changes made)
(291,890 real changes made)
(291,890 real changes made)
(291,890 real changes made)
(291,890 real changes made)
(291,890 real changes made)
(1,193,550 missing values generated)
(1,445,928 missing values generated)
(1,706,178 missing values generated)
(1,320,042 missing values generated)
(1,594,164 missing values generated)
(1,538,508 missing values generated)
(1,733,712 missing values generated)
(1,727,298 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        86,772
        from master                         0  (_merge==1)
        from using                     86,772  (_merge==2)

    Matched                         1,094,206  (_merge==3)
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                         1,180,978  (_merge==3)
    -----------------------------------------
(86,854 missing values generated)
(1,180,978 missing values generated)
(617,388 real changes made)
(563,590 real changes made)
(1,180,978 missing values generated)
(424,375 real changes made)
(756,603 real changes made)
(1,180,978 missing values generated)
(304,603 real changes made)
(876,375 real changes made)
(1,180,978 missing values generated)
(88,011 real changes made)
(1,074,996 real changes made)
indlang: all characters numeric; replaced as int
(1092967 missing values generated)
(1,180,978 missing values generated)
(31,267 real changes made)
(1,043,729 real changes made)
(1,180,978 missing values generated)
(379,588 real changes made)
(783,419 real changes made)
(1,180,978 missing values generated)
(248,628 real changes made)
(914,379 real changes made)
(1,180,978 missing values generated)
(67,886 real changes made)
(26,065 real changes made)
(31,074 real changes made)
(42,587 real changes made)
(57,388 real changes made)
(35,527 real changes made)
(33,028 real changes made)
(158,278 real changes made)
(28,522 real changes made)
(38,642 real changes made)
(263,677 real changes made)
(31,525 real changes made)
(33,022 real changes made)
(126,913 real changes made)
(219 real changes made)
(303 real changes made)
(1,227 real changes made)
(3,923 real changes made)
(919 real changes made)
(2,121 real changes made)
(7,888 real changes made)
(20,001 real changes made)
(1,972 real changes made)
(0 real changes made)
(13,563 real changes made)
(13,998 real changes made)
(15,889 real changes made)
(45,969 real changes made)
(47,995 real changes made)
(982 real changes made)
(7,344 real changes made)
(1,822 real changes made)
(605 real changes made)
(680 real changes made)
(469 real changes made)
(289 real changes made)
(60 real changes made)
state: all characters numeric; replaced as byte
(1,180,978 missing values generated)
(741,218 real changes made)
(309,498 real changes made)
(1,180,978 real changes made)
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St12720.000007 saved
    as .dta format
Finished processing 2018. Total individuals so far: 527011
Processing ENIGH 2020 dataset...
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St12720.000008 saved
    as .dta format
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St12720.000009 saved
    as .dta format
(394,912 missing values generated)
variable clave_group was str1 now str5
(105,036 real changes made)
variable clave_group was str5 now str15
(77,930 real changes made)
(22,366 real changes made)
(48,079 real changes made)
(14,845 real changes made)
(19,345 real changes made)
(26,246 real changes made)
(24,210 real changes made)
(3,601 real changes made)
(827 real changes made)
(8,586 real changes made)
(30,480 real changes made)
(6,290 real changes made)
(7,071 real changes made)
(3,680 real changes made)
(28,353 real changes made)
(3,680 real changes made)
(28,353 real changes made)
(3,680 real changes made)
(28,353 real changes made)
(3,680 real changes made)
(28,353 real changes made)
(3,680 real changes made)
(28,353 real changes made)
(3,680 real changes made)
(28,353 real changes made)
(j = 1 2 3 4 5 6)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations          330,953   ->   1,985,718   
Number of variables                  14   ->   10          
j variable (6 values)                     ->   month
xij variables:
                  ing_1 ing_2 ... ing_6   ->   ing_
-----------------------------------------------------------------------------
(1,985,718 missing values generated)
variable mes was str1 now str2
(330,953 real changes made)
(330,953 real changes made)
(330,953 real changes made)
(330,953 real changes made)
(330,953 real changes made)
(330,953 real changes made)
(1,358,298 missing values generated)
(1,629,912 missing values generated)
(1,930,788 missing values generated)
(1,564,380 missing values generated)
(1,788,294 missing values generated)
(1,719,594 missing values generated)
(1,964,268 missing values generated)
(1,944,492 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                       111,411
        from master                         0  (_merge==1)
        from using                    111,411  (_merge==2)

    Matched                         1,225,886  (_merge==3)
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                         1,337,297  (_merge==3)
    -----------------------------------------
(111,437 missing values generated)
(1,337,297 missing values generated)
(705,695 real changes made)
(631,602 real changes made)
(1,337,297 missing values generated)
(463,345 real changes made)
(873,952 real changes made)
(1,337,297 missing values generated)
(323,489 real changes made)
(1,013,808 real changes made)
(1,337,297 missing values generated)
(92,088 real changes made)
(1,227,402 real changes made)
indlang: all characters numeric; replaced as int
(1245209 missing values generated)
(1,337,297 missing values generated)
(34,213 real changes made)
(1,193,189 real changes made)
(1,337,297 missing values generated)
(424,611 real changes made)
(894,879 real changes made)
(1,337,297 missing values generated)
(239,551 real changes made)
(1,079,939 real changes made)
(1,337,297 missing values generated)
(73,439 real changes made)
(23,591 real changes made)
(30,175 real changes made)
(43,071 real changes made)
(59,022 real changes made)
(33,200 real changes made)
(30,071 real changes made)
(173,464 real changes made)
(27,244 real changes made)
(38,560 real changes made)
(297,588 real changes made)
(40,373 real changes made)
(42,074 real changes made)
(164,049 real changes made)
(324 real changes made)
(433 real changes made)
(1,535 real changes made)
(4,877 real changes made)
(1,153 real changes made)
(2,660 real changes made)
(10,064 real changes made)
(23,894 real changes made)
(2,471 real changes made)
(0 real changes made)
(17,908 real changes made)
(17,716 real changes made)
(21,959 real changes made)
(61,817 real changes made)
(59,121 real changes made)
(1,327 real changes made)
(9,911 real changes made)
(2,439 real changes made)
(877 real changes made)
(911 real changes made)
(739 real changes made)
(464 real changes made)
(157 real changes made)
state: all characters numeric; replaced as byte
(1,337,297 missing values generated)
(850,635 real changes made)
(374,592 real changes made)
(1,337,297 real changes made)
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St12720.00000a saved
    as .dta format
Finished processing 2020. Total individuals so far: 842754
Processing ENIGH 2022 dataset...
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St12720.00000b saved
    as .dta format
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St12720.00000c saved
    as .dta format
(397,182 missing values generated)
variable clave_group was str1 now str5
(110,402 real changes made)
variable clave_group was str5 now str15
(84,222 real changes made)
(23,950 real changes made)
(45,981 real changes made)
(14,729 real changes made)
(25,737 real changes made)
(21,939 real changes made)
(19,972 real changes made)
(3,532 real changes made)
(806 real changes made)
(6,025 real changes made)
(29,508 real changes made)
(6,216 real changes made)
(4,163 real changes made)
(3,720 real changes made)
(28,917 real changes made)
(3,720 real changes made)
(28,917 real changes made)
(3,720 real changes made)
(28,917 real changes made)
(3,720 real changes made)
(28,917 real changes made)
(3,720 real changes made)
(28,917 real changes made)
(3,720 real changes made)
(28,917 real changes made)
(j = 1 2 3 4 5 6)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations          327,762   ->   1,966,572   
Number of variables                  14   ->   10          
j variable (6 values)                     ->   month
xij variables:
                  ing_1 ing_2 ... ing_6   ->   ing_
-----------------------------------------------------------------------------
(1,966,572 missing values generated)
variable mes was str1 now str2
(327,762 real changes made)
(327,762 real changes made)
(327,762 real changes made)
(327,762 real changes made)
(327,762 real changes made)
(327,762 real changes made)
(1,307,484 missing values generated)
(1,591,002 missing values generated)
(1,926,768 missing values generated)
(1,536,456 missing values generated)
(1,776,432 missing values generated)
(1,740,204 missing values generated)
(1,945,566 missing values generated)
(1,942,092 missing values generated)

    Result                      Number of obs
    -----------------------------------------
    Not matched                       104,540
        from master                         0  (_merge==1)
        from using                    104,540  (_merge==2)

    Matched                         1,230,843  (_merge==3)
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                         1,335,383  (_merge==3)
    -----------------------------------------
(104,549 missing values generated)
(1,335,383 missing values generated)
(691,643 real changes made)
(643,740 real changes made)
(1,335,383 missing values generated)
(448,619 real changes made)
(886,764 real changes made)
(1,335,383 missing values generated)
(300,797 real changes made)
(1,034,586 real changes made)
(1,335,383 missing values generated)
(96,106 real changes made)
(1,223,280 real changes made)
indlang: all characters numeric; replaced as int
(1239277 missing values generated)
(1,335,383 missing values generated)
(33,603 real changes made)
(1,189,677 real changes made)
(1,335,383 missing values generated)
(385,553 real changes made)
(933,833 real changes made)
(1,335,383 missing values generated)
(227,492 real changes made)
(1,091,894 real changes made)
(1,335,383 missing values generated)
(67,945 real changes made)
(23,830 real changes made)
(26,776 real changes made)
(39,616 real changes made)
(55,345 real changes made)
(32,288 real changes made)
(28,153 real changes made)
(170,232 real changes made)
(25,160 real changes made)
(35,997 real changes made)
(302,230 real changes made)
(36,305 real changes made)
(40,908 real changes made)
(178,087 real changes made)
(393 real changes made)
(553 real changes made)
(1,603 real changes made)
(4,429 real changes made)
(1,220 real changes made)
(2,406 real changes made)
(8,731 real changes made)
(23,413 real changes made)
(2,545 real changes made)
(0 real changes made)
(16,149 real changes made)
(17,030 real changes made)
(23,091 real changes made)
(66,648 real changes made)
(70,078 real changes made)
(1,300 real changes made)
(9,840 real changes made)
(2,960 real changes made)
(731 real changes made)
(932 real changes made)
(874 real changes made)
(474 real changes made)
(258 real changes made)
state: all characters numeric; replaced as byte
(1,335,383 missing values generated)
(873,503 real changes made)
(354,176 real changes made)
(1,335,383 real changes made)
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St12720.00000d saved
    as .dta format
Finished processing 2022. Total individuals so far: 1152438

. 
. *************************************************
. ********* Append all datasets *******************
. *************************************************
. 
. display "Appending all datasets..."
Appending all datasets...

. 
. * Load first dataset
. local first_year : word 1 of `years'

. use `enighdata`first_year'', clear

. 
. * Append remaining datasets in loop
. local remaining_years : list years - first_year

. foreach year of local remaining_years {
  2.     append using `enighdata`year''
  3. }
(label employedlbl already defined)
(label states already defined)
(label school_attendlbl already defined)
(label indigenouslbl already defined)
(label indundlbl already defined)
(label indlanglbl already defined)
(label indspeakerlbl already defined)
(label fatherlbl already defined)
(label motherlbl already defined)
(label genderlbl already defined)
(label employedlbl already defined)
(label states already defined)
(label school_attendlbl already defined)
(label indigenouslbl already defined)
(label indundlbl already defined)
(label indlanglbl already defined)
(label indspeakerlbl already defined)
(label fatherlbl already defined)
(label motherlbl already defined)
(label genderlbl already defined)
(label employedlbl already defined)
(label states already defined)
(label school_attendlbl already defined)
(label indigenouslbl already defined)
(label indundlbl already defined)
(label indlanglbl already defined)
(label indspeakerlbl already defined)
(label fatherlbl already defined)
(label motherlbl already defined)
(label genderlbl already defined)

. 
. sort id time

. merge m:1 time using `deflators'

    Result                      Number of obs
    -----------------------------------------
    Not matched                       385,665
        from master                   385,617  (_merge==1)
        from using                         48  (_merge==2)

    Matched                         4,601,004  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(48 observations deleted)

. drop _merge

. 
. *************************************************
. **************** New Variables ******************
. *************************************************
. 
. *destring ubica_geo
. destring ubica_geo, replace
ubica_geo: all characters numeric; replaced as int

. 
. *gen income variable
. egen ingreso = rowtotal(ing_wages ing_non_wage_income ing_fin_capital ing_gov
> _transfers ing_negocio ing_other ing_rentas ing_ventas)

. order ingreso, before(ing_wages)

. 
. *generate treatment
. gen zona_a = 0

. replace zona_a = 1 if inlist(ubica_geo, 02001, 02002, 02003, 02004, 02005, 26
> 055, 26048, 26070, 26017, 26004) ///
>     | inlist(ubica_geo, 26060, 26043, 26059, 26039, 26002, 08035, 08005, 0803
> 7, 08053, 08028) ///
>     | inlist(ubica_geo, 08015, 08052, 08042, 05023, 05002, 05038, 05014, 0502
> 2, 05025, 05012) ///
>     | inlist(ubica_geo, 05013, 19005, 28027, 28014, 28024, 28025, 28015, 2800
> 7, 28022, 28032) ///
>     | inlist(ubica_geo, 28033, 28040)
(94,141 real changes made)

. 
. *generate REAL income variables
. gen ingreso_real = (ingreso / inpc) * 100
(385,617 missing values generated)

. gen ing_wages_real = (ing_wages / inpc) * 100
(2,619,411 missing values generated)

. gen ing_non_wage_income_real = (ing_non_wage_income / inpc) * 100
(3,659,727 missing values generated)

. gen ing_fin_capital_real = (ing_fin_capital / inpc) * 100
(4,802,373 missing values generated)

. gen ing_gov_transfers_real = (ing_gov_transfers / inpc) * 100
(3,275,841 missing values generated)

. gen ing_negocio_real = (ing_negocio / inpc) * 100
(4,295,187 missing values generated)

. gen ing_other_real = (ing_other / inpc) * 100
(4,075,101 missing values generated)

. gen ing_rentas_real = (ing_rentas / inpc) * 100
(4,910,175 missing values generated)

. gen ing_ventas_real = (ing_ventas / inpc) * 100
(4,874,037 missing values generated)

. 
. *generate log of income sources
. gen lni = ln(ingreso_real) if ingreso_real > 0
(1,111,210 missing values generated)

. gen lnw = ln(ing_wages_real) if ing_wages_real > 0
(2,884,954 missing values generated)

. gen lnnwi = ln(ing_non_wage_income_real) if ing_non_wage_income_real > 0
(4,404,134 missing values generated)

. gen lnfc = ln(ing_fin_capital_real) if ing_fin_capital_real > 0
(4,937,722 missing values generated)

. gen lngt = ln(ing_gov_transfers_real) if ing_gov_transfers_real > 0
(3,901,910 missing values generated)

. gen lnn = ln(ing_negocio_real) if ing_negocio_real > 0
(4,366,470 missing values generated)

. gen lno = ln(ing_other_real) if ing_other_real > 0
(4,499,459 missing values generated)

. gen lnr = ln(ing_rentas_real) if ing_rentas_real > 0
(4,922,677 missing values generated)

. gen lnv = ln(ing_ventas_real) if ing_ventas_real > 0
(4,961,459 missing values generated)

. 
. *************************************************
. **************** Sample Select ******************
. *************************************************
. 
. drop if time == .
(385,617 observations deleted)

. drop if edad <= 12
(351,000 observations deleted)

. gen edadsq = edad*edad

. sort id time

. order year, after(time)

. 
. *save dataset
. save "../output/enighdata.dta", replace
file ../output/enighdata.dta saved

. *save "$output/enighdata.dta", replace
. 
end of do-file
