
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 18.5
___/   /   /___/   /   /___/       SE—Standard Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: Unlimited-user network, expiring 30 Jun 2025
Serial number: 401809303522
  Licensed to: Victor Ortega
               UNAM

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.

. do "enighdata.do" 

. /*Clean Memory*/
. clear

. cap clear

. cap log close

. set more off

. 
. /*Install Programs*/
. ssc install tabout
checking tabout consistency and verifying not already installed...
all files already exist and are up to date.

. 
. *** REPLICATION FILE: enighdata
. *** STATA VERSION: 18/SE
. *** AUTHOR: Victor Alfonso Ortega Le Hénanff
. *** EMAIL: vincictor33@gmail.com
. *** DATE: 2025-02-16
. 
. // First dataset preparation
. use "../input/poblacion2016.dta", clear

. egen new_id = concat(folioviv foliohog numren)

. keep new_id hablaind lenguaind comprenind etnia sexo edad madre_hog padre_hog
>  asis_esc nivel grado residencia hor_1 trabajo_mp 

. tempfile pop_data

. save `pop_data'
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St53009.000001 saved
    as .dta format

. 
. // Second dataset preparation - negocios
. use "../input/ingresos2016.dta", clear

. egen new_id = concat(folioviv foliohog numren)

. gen negocio = inrange(real(substr(clave, 2, .)), 68, 81)

. keep if negocio == 1
(307,098 observations deleted)

. collapse (sum) ing_1 ing_2 ing_3 ing_4 ing_5 ing_6 ing_tri ///
>         (first) mes_1 mes_2 mes_3 mes_4 mes_5 mes_6 negocio, ///
>         by(new_id)

. gen clave = "6"

. tempfile negocios

. save `negocios'
file /var/folders/ym/ly4nlkxs5_3dmz2_2h7wxvr80000gn/T//St53009.000002 saved
    as .dta format

. 
. use "../input/ingresos2016.dta", clear

. egen new_id = concat(folioviv foliohog numren)

. gen negocio = inrange(real(substr(clave, 2, .)), 68, 81)

. append using `negocios'

. drop if inrange(real(substr(clave, 2, .)), 68, 81)
(27,239 observations deleted)

. 
. merge m:1 new_id using `pop_data'

    Result                      Number of obs
    -----------------------------------------
    Not matched                        82,686
        from master                         0  (_merge==1)
        from using                     82,686  (_merge==2)

    Matched                           331,547  (_merge==3)
    -----------------------------------------

. 
. reshape long mes_ ing_, i(new_id clave) j(obs)
(j = 1 2 3 4 5 6)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations          414,233   ->   2,485,398   
Number of variables                  34   ->   25          
j variable (6 values)                     ->   obs
xij variables:
                  mes_1 mes_2 ... mes_6   ->   mes_
                  ing_1 ing_2 ... ing_6   ->   ing_
-----------------------------------------------------------------------------

. rename ing_ income

. gen month = mes_
(496,116 missing values generated)

. drop mes_ obs

. order new_id month, before(folioviv)

. 
end of do-file
